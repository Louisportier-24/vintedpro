<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VintedPro</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Figtree:ital,wght@0,300;0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #07090f;
  --surface: #0e1118;
  --surface2: #151922;
  --surface3: #1c2130;
  --border: rgba(255,255,255,0.055);
  --border2: rgba(255,255,255,0.09);
  --teal: #00c9a7;
  --teal-glow: rgba(0,201,167,0.15);
  --teal-dim: rgba(0,201,167,0.08);
  --amber: #ffab40;
  --rose: #ff6b8a;
  --blue: #5b9cf6;
  --green: #4ade80;
  --violet: #a78bfa;
  --text: #f0f2f7;
  --muted: #4a5268;
  --muted2: #7d8aa0;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 14px; scroll-behavior: smooth; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Figtree', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARED UTILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.screen { display: none; min-height: 100vh; }
.screen.active { display: flex; }

.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 7px;
  padding: 11px 22px; border-radius: 10px; font-size: 0.88rem;
  font-weight: 600; cursor: pointer; border: none;
  font-family: 'Figtree', sans-serif; transition: all 0.2s; outline: none;
  letter-spacing: 0.01em;
}
.btn-primary { background: var(--teal); color: #000; }
.btn-primary:hover { background: #00e0bb; box-shadow: 0 0 24px rgba(0,201,167,0.35); transform: translateY(-1px); }
.btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }
.btn-ghost { background: var(--surface2); color: var(--muted2); border: 1px solid var(--border2); }
.btn-ghost:hover { color: var(--text); border-color: rgba(255,255,255,0.14); }
.btn-full { width: 100%; }

.form-group { margin-bottom: 18px; }
.form-label {
  display: block; font-size: 0.72rem; text-transform: uppercase;
  letter-spacing: 1.8px; color: var(--muted2); margin-bottom: 8px; font-weight: 600;
}
.form-input {
  width: 100%; background: var(--surface2); border: 1px solid var(--border2);
  border-radius: 10px; padding: 12px 16px; color: var(--text);
  font-family: 'Figtree', sans-serif; font-size: 0.9rem; outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.form-input:focus { border-color: var(--teal); box-shadow: 0 0 0 3px var(--teal-dim); }
.form-input::placeholder { color: var(--muted); }
.form-select {
  width: 100%; background: var(--surface2); border: 1px solid var(--border2);
  border-radius: 10px; padding: 12px 16px; color: var(--text);
  font-family: 'Figtree', sans-serif; font-size: 0.9rem; outline: none;
  cursor: pointer; transition: border-color 0.2s; appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%237d8aa0' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 14px center;
  padding-right: 36px;
}
.form-select:focus { border-color: var(--teal); box-shadow: 0 0 0 3px var(--teal-dim); }
.form-select option { background: var(--surface2); }
textarea.form-input { resize: vertical; min-height: 80px; line-height: 1.5; }

.error-banner {
  background: rgba(255,107,138,0.1); border: 1px solid rgba(255,107,138,0.25);
  color: var(--rose); border-radius: 8px; padding: 10px 14px;
  font-size: 0.8rem; margin-bottom: 16px; display: none;
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(16px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes fadeIn {
  from { opacity: 0; } to { opacity: 1; }
}
@keyframes spin { to { transform: rotate(360deg); } }
@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

.spinner {
  width: 18px; height: 18px; border: 2px solid rgba(0,0,0,0.15);
  border-top-color: #000; border-radius: 50%; animation: spin 0.7s linear infinite;
  flex-shrink: 0;
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN 1 â€” LOGIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-login {
  align-items: center; justify-content: center; position: relative; overflow: hidden;
  background:
    radial-gradient(ellipse 900px 600px at 75% 10%, rgba(0,201,167,0.05) 0%, transparent 55%),
    radial-gradient(ellipse 600px 700px at 15% 90%, rgba(91,156,246,0.04) 0%, transparent 55%),
    var(--bg);
}

/* Decorative grid */
#screen-login::before {
  content: '';
  position: absolute; inset: 0;
  background-image:
    linear-gradient(var(--border) 1px, transparent 1px),
    linear-gradient(90deg, var(--border) 1px, transparent 1px);
  background-size: 60px 60px;
  mask-image: radial-gradient(ellipse 70% 70% at 50% 50%, black 20%, transparent 70%);
  pointer-events: none;
}

.login-wrap {
  width: 420px; position: relative; z-index: 1;
  animation: fadeUp 0.7s cubic-bezier(0.22,1,0.36,1) both;
}

.login-brand {
  text-align: center; margin-bottom: 36px;
}
.brand-logo {
  font-family: 'Syne', sans-serif; font-weight: 800;
  font-size: 2rem; letter-spacing: -1px; line-height: 1;
}
.brand-logo em { color: var(--teal); font-style: normal; }
.brand-tagline {
  font-size: 0.82rem; color: var(--muted2); margin-top: 6px; line-height: 1.5;
}

.login-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 20px; padding: 36px 36px 32px;
  box-shadow: 0 32px 64px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.025);
}
.login-title {
  font-family: 'Syne', sans-serif; font-weight: 700; font-size: 1.25rem;
  margin-bottom: 4px; letter-spacing: -0.3px;
}
.login-sub { font-size: 0.8rem; color: var(--muted2); margin-bottom: 28px; }

.input-icon-wrap { position: relative; }
.input-icon-wrap .form-input { padding-left: 42px; }
.input-icon {
  position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
  color: var(--muted); font-size: 1rem; pointer-events: none;
}
.input-eye {
  position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
  color: var(--muted); cursor: pointer; font-size: 0.9rem; user-select: none;
}
.input-eye:hover { color: var(--muted2); }

.forgot-link {
  font-size: 0.75rem; color: var(--teal); text-decoration: none;
  float: right; margin-top: -12px; margin-bottom: 20px; display: block;
  opacity: 0.8;
}
.forgot-link:hover { opacity: 1; }

.login-footer {
  text-align: center; margin-top: 20px;
  font-size: 0.75rem; color: var(--muted2);
}
.login-footer a { color: var(--teal); text-decoration: none; }

/* Demo hint */
.demo-hint {
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 10px; padding: 10px 14px;
  font-size: 0.75rem; color: var(--muted2); text-align: center;
  margin-top: 16px; line-height: 1.5;
}
.demo-hint strong { color: var(--muted2); font-weight: 500; }
.demo-hint code {
  background: var(--surface3); color: var(--teal); padding: 1px 6px;
  border-radius: 4px; font-size: 0.72rem;
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN 2 â€” ONBOARDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-onboarding {
  align-items: center; justify-content: center;
  background: var(--bg);
  padding: 40px 20px;
}

.onboarding-wrap {
  width: 560px; max-width: 100%;
  animation: fadeUp 0.6s cubic-bezier(0.22,1,0.36,1) both;
}

.onboarding-header { margin-bottom: 32px; }
.onboarding-step-track {
  display: flex; align-items: center; gap: 0; margin-bottom: 28px;
}
.step-item {
  display: flex; flex-direction: column; align-items: center; flex: 1;
  position: relative;
}
.step-item:not(:last-child)::after {
  content: ''; position: absolute; top: 14px; left: 50%; width: 100%;
  height: 1px; background: var(--border2);
  z-index: 0;
}
.step-item.done::after, .step-item.active::after { background: var(--teal); }
.step-num {
  width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--border2);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.72rem; font-weight: 700; color: var(--muted); z-index: 1;
  background: var(--bg); transition: all 0.3s; font-family: 'Syne', sans-serif;
}
.step-item.active .step-num { border-color: var(--teal); color: var(--teal); background: var(--teal-dim); }
.step-item.done .step-num { border-color: var(--teal); background: var(--teal); color: #000; }
.step-label { font-size: 0.65rem; color: var(--muted); margin-top: 6px; letter-spacing: 0.5px; text-align: center; }
.step-item.active .step-label { color: var(--teal); }
.step-item.done .step-label { color: var(--muted2); }

.onboarding-title {
  font-family: 'Syne', sans-serif; font-weight: 700; font-size: 1.4rem;
  letter-spacing: -0.3px; margin-bottom: 6px;
}
.onboarding-sub { font-size: 0.82rem; color: var(--muted2); line-height: 1.5; }

.onboarding-card {
  background: var(--surface); border: 1px solid var(--border2);
  border-radius: 18px; padding: 32px; margin-bottom: 16px;
  box-shadow: 0 16px 48px rgba(0,0,0,0.35);
}

.onboarding-step { display: none; }
.onboarding-step.active { display: block; animation: fadeIn 0.3s ease; }

/* Choice cards */
.choice-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.choice-card {
  border: 1.5px solid var(--border2); border-radius: 12px; padding: 16px;
  cursor: pointer; transition: all 0.2s; text-align: center; background: var(--surface2);
}
.choice-card:hover { border-color: rgba(0,201,167,0.3); background: var(--surface3); }
.choice-card.selected { border-color: var(--teal); background: var(--teal-dim); }
.choice-icon { font-size: 1.6rem; margin-bottom: 8px; }
.choice-label { font-size: 0.82rem; font-weight: 500; color: var(--text); }
.choice-sub { font-size: 0.72rem; color: var(--muted2); margin-top: 3px; }

.tag-grid { display: flex; flex-wrap: wrap; gap: 8px; }
.tag-toggle {
  border: 1.5px solid var(--border2); border-radius: 99px; padding: 5px 14px;
  cursor: pointer; font-size: 0.8rem; font-weight: 500; color: var(--muted2);
  transition: all 0.2s; background: var(--surface2);
}
.tag-toggle:hover { border-color: rgba(0,201,167,0.3); color: var(--text); }
.tag-toggle.selected { border-color: var(--teal); background: var(--teal-dim); color: var(--teal); }

.onboarding-nav {
  display: flex; align-items: center; justify-content: space-between; gap: 12px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN 3 â€” DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-dashboard {
  flex-direction: row;
  animation: fadeIn 0.4s ease;
}

/* Sidebar */
.sidebar {
  width: 230px; flex-shrink: 0;
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex; flex-direction: column;
  position: sticky; top: 0; height: 100vh; overflow-y: auto;
}
.sidebar-top { padding: 24px 20px 20px; border-bottom: 1px solid var(--border); }
.sb-logo {
  font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.2rem; letter-spacing: -0.5px;
}
.sb-logo em { color: var(--teal); font-style: normal; }
.sb-user {
  margin-top: 14px; display: flex; align-items: center; gap: 10px;
}
.sb-avatar {
  width: 34px; height: 34px; border-radius: 10px;
  background: linear-gradient(135deg, var(--teal), #006e5a);
  display: flex; align-items: center; justify-content: center;
  font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.85rem; color: #000;
  flex-shrink: 0;
}
.sb-username { font-size: 0.82rem; font-weight: 600; color: var(--text); }
.sb-plan { font-size: 0.68rem; color: var(--teal); margin-top: 1px; }

.sidebar-nav { padding: 14px 12px; flex: 1; }
.nav-section {
  font-size: 0.62rem; text-transform: uppercase; letter-spacing: 2px;
  color: var(--muted); padding: 10px 10px 6px; margin-top: 6px;
}
.nav-item {
  display: flex; align-items: center; gap: 10px;
  padding: 9px 10px; border-radius: 9px; cursor: pointer;
  color: var(--muted2); font-size: 0.84rem; font-weight: 500;
  transition: all 0.2s; margin-bottom: 1px; position: relative;
  user-select: none;
}
.nav-item svg { width: 16px; height: 16px; flex-shrink: 0; opacity: 0.7; }
.nav-item:hover { background: var(--surface2); color: var(--text); }
.nav-item:hover svg { opacity: 1; }
.nav-item.active { background: var(--teal-dim); color: var(--teal); }
.nav-item.active svg { opacity: 1; }
.nav-item.active::before {
  content: ''; position: absolute; left: 0; top: 20%; height: 60%;
  width: 3px; background: var(--teal); border-radius: 0 3px 3px 0;
}
.nav-badge {
  margin-left: auto; background: var(--rose); color: #fff;
  font-size: 0.62rem; font-weight: 700; padding: 1px 6px; border-radius: 99px;
}

.sidebar-footer {
  padding: 14px 12px; border-top: 1px solid var(--border);
  display: flex; flex-direction: column; gap: 6px;
}
.sidebar-footer-btn {
  display: flex; align-items: center; gap: 9px; padding: 8px 10px;
  border-radius: 8px; font-size: 0.8rem; color: var(--muted2); cursor: pointer;
  transition: all 0.2s;
}
.sidebar-footer-btn:hover { background: var(--surface2); color: var(--text); }
.sidebar-footer-btn svg { width: 15px; height: 15px; flex-shrink: 0; }

/* Main */
.main-content {
  flex: 1; overflow-y: auto; padding: 32px 36px; min-width: 0;
  background: var(--bg);
}

.page-header {
  display: flex; align-items: flex-start; justify-content: space-between;
  margin-bottom: 32px; animation: fadeUp 0.5s ease both;
}
.page-title {
  font-family: 'Syne', sans-serif; font-weight: 700; font-size: 1.65rem;
  letter-spacing: -0.5px;
}
.page-sub {
  font-size: 0.78rem; color: var(--muted2); margin-top: 4px;
  display: flex; align-items: center; gap: 8px;
}
.sync-dot {
  display: inline-block; width: 7px; height: 7px; border-radius: 50%;
  background: var(--green); box-shadow: 0 0 6px rgba(74,222,128,0.6);
}
.header-actions { display: flex; gap: 10px; align-items: center; }

/* KPIs */
.kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 26px; }
.kpi-card {
  background: var(--surface); border: 1px solid var(--border); border-radius: 14px;
  padding: 20px 22px; position: relative; overflow: hidden;
  transition: border-color 0.2s, transform 0.2s;
  animation: fadeUp 0.5s ease both;
}
.kpi-card:hover { border-color: var(--border2); transform: translateY(-2px); }
.kpi-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
  border-radius: 14px 14px 0 0;
}
.kpi-card.k0::before { background: linear-gradient(90deg, var(--teal), transparent 70%); }
.kpi-card.k1::before { background: linear-gradient(90deg, var(--amber), transparent 70%); }
.kpi-card.k2::before { background: linear-gradient(90deg, var(--rose), transparent 70%); }
.kpi-card.k3::before { background: linear-gradient(90deg, var(--violet), transparent 70%); }
.kpi-label { font-size: 0.68rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--muted); margin-bottom: 10px; }
.kpi-val { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 2rem; line-height: 1; letter-spacing: -1.5px; margin-bottom: 8px; }
.kpi-card.k0 .kpi-val { color: var(--teal); }
.kpi-card.k1 .kpi-val { color: var(--amber); }
.kpi-card.k2 .kpi-val { color: var(--rose); }
.kpi-card.k3 .kpi-val { color: var(--violet); }
.kpi-delta { font-size: 0.73rem; font-weight: 500; display: flex; align-items: center; gap: 4px; }
.kpi-delta.up { color: var(--green); }
.kpi-delta.neutral { color: var(--muted2); }
.kpi-bg-icon { position: absolute; bottom: 12px; right: 16px; font-size: 2.2rem; opacity: 0.05; }

/* Loading skeleton */
.skeleton {
  background: linear-gradient(90deg, var(--surface2) 25%, var(--surface3) 50%, var(--surface2) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.4s infinite;
  border-radius: 6px;
}

/* Data section */
.data-section { animation: fadeUp 0.5s ease 0.15s both; }
.section-header {
  display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px;
}
.section-title { font-family: 'Syne', sans-serif; font-weight: 600; font-size: 1rem; }
.section-meta { font-size: 0.75rem; color: var(--muted2); }

.toolbar {
  display: flex; align-items: center; gap: 10px; margin-bottom: 14px;
}
.toolbar-search {
  flex: 1; background: var(--surface); border: 1px solid var(--border);
  border-radius: 9px; padding: 9px 14px 9px 36px; color: var(--text);
  font-family: 'Figtree', sans-serif; font-size: 0.84rem; outline: none;
  transition: border-color 0.2s; position: relative;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='15' height='15' viewBox='0 0 24 24' fill='none' stroke='%234a5268' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='m21 21-4.35-4.35'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: 12px center;
}
.toolbar-search:focus { border-color: var(--teal); }
.toolbar-search::placeholder { color: var(--muted); }

.table-wrap {
  background: var(--surface); border: 1px solid var(--border); border-radius: 14px;
  overflow: hidden;
}
.data-table { width: 100%; border-collapse: collapse; }
.data-table th {
  font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1.5px;
  color: var(--muted); text-align: left; padding: 13px 18px 12px;
  background: var(--surface2); border-bottom: 1px solid var(--border);
  white-space: nowrap; font-weight: 600;
}
.data-table td {
  padding: 12px 18px; font-size: 0.83rem;
  border-bottom: 1px solid var(--border); vertical-align: middle;
}
.data-table tr:last-child td { border-bottom: none; }
.data-table tbody tr { transition: background 0.12s; cursor: default; }
.data-table tbody tr:hover td { background: var(--surface2); }

.cell-title { font-weight: 500; color: var(--text); }
.cell-num { font-family: 'Syne', sans-serif; font-weight: 600; color: var(--teal); }
.cell-date { font-size: 0.76rem; color: var(--muted2); }
.cell-empty { color: var(--muted); }
.tag {
  display: inline-block; padding: 2px 10px; border-radius: 99px;
  font-size: 0.7rem; font-weight: 600; margin: 1px; letter-spacing: 0.2px;
}
.cell-url a { color: var(--blue); text-decoration: none; font-size: 0.76rem; }
.cell-url a:hover { text-decoration: underline; }

.pagination-bar {
  display: flex; align-items: center; justify-content: space-between;
  padding: 11px 18px; border-top: 1px solid var(--border); background: var(--surface2);
}
.pagination-info { font-size: 0.74rem; color: var(--muted2); }
.pagination-btns { display: flex; gap: 5px; }
.pg-btn {
  padding: 4px 11px; border-radius: 6px; font-size: 0.76rem; font-weight: 500;
  background: var(--surface3); border: 1px solid var(--border); color: var(--muted2);
  cursor: pointer; transition: all 0.15s; font-family: 'Figtree', sans-serif;
}
.pg-btn:hover:not(:disabled) { color: var(--text); border-color: var(--border2); }
.pg-btn.active { background: var(--teal-dim); color: var(--teal); border-color: rgba(0,201,167,0.25); }
.pg-btn:disabled { opacity: 0.25; cursor: not-allowed; }

.empty-state {
  padding: 56px 24px; text-align: center;
}
.empty-icon { font-size: 2.2rem; opacity: 0.2; margin-bottom: 12px; }
.empty-title { font-family: 'Syne', sans-serif; font-size: 0.95rem; color: var(--muted2); margin-bottom: 5px; }
.empty-sub { font-size: 0.76rem; color: var(--muted); }

/* Scrollbar */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--surface3); border-radius: 99px; }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN 1 â€” LOGIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-login" class="screen active" style="flex-direction:column;">
  <div class="login-wrap">
    <div class="login-brand">
      <div class="brand-logo">Vinted<em>Pro</em></div>
      <div class="brand-tagline">Pilotez votre activitÃ© de vente en un coup d'Å“il</div>
    </div>
    <div class="login-card">
      <div class="login-title">Connexion</div>
      <div class="login-sub">AccÃ©dez Ã  votre espace personnel</div>
      <div class="error-banner" id="login-error"></div>
      <div class="form-group">
        <label class="form-label">Adresse e-mail</label>
        <div class="input-icon-wrap">
          <span class="input-icon">âœ‰</span>
          <input id="login-email" class="form-input" type="email" placeholder="vous@exemple.com" />
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Mot de passe</label>
        <div class="input-icon-wrap">
          <span class="input-icon">ğŸ”’</span>
          <input id="login-password" class="form-input" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
          <span class="input-eye" onclick="togglePwd()">ğŸ‘</span>
        </div>
      </div>
      <a href="#" class="forgot-link">Mot de passe oubliÃ© ?</a>
      <button class="btn btn-primary btn-full" id="login-btn">
        <span id="login-label">Se connecter</span>
      </button>
      <div class="login-footer">
        Pas encore de compte ? <a href="#">Contactez-nous</a>
      </div>
    </div>
    <div class="demo-hint">
      <strong>DÃ©mo</strong> â€” Essayez avec l'e-mail <code>demo@vintedpro.fr</code> et le mot de passe <code>demo1234</code>
    </div>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN 2 â€” ONBOARDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-onboarding" class="screen" style="flex-direction:column;">
  <div class="onboarding-wrap">

    <!-- Step tracker -->
    <div class="onboarding-step-track" id="step-track">
      <div class="step-item active" id="track-1">
        <div class="step-num">1</div>
        <div class="step-label">Profil</div>
      </div>
      <div class="step-item" id="track-2">
        <div class="step-num">2</div>
        <div class="step-label">ActivitÃ©</div>
      </div>
      <div class="step-item" id="track-3">
        <div class="step-num">3</div>
        <div class="step-label">Objectifs</div>
      </div>
    </div>

    <!-- Step 1 â€” Profil -->
    <div id="ob-step-1" class="onboarding-step active">
      <div class="onboarding-header">
        <div class="onboarding-title">Bienvenue ! Faisons connaissance ğŸ‘‹</div>
        <div class="onboarding-sub">Ces informations nous permettent de personnaliser votre tableau de bord.</div>
      </div>
      <div class="onboarding-card">
        <div class="form-group">
          <label class="form-label">Votre prÃ©nom</label>
          <input id="ob-prenom" class="form-input" type="text" placeholder="Ex : Marie" />
        </div>
        <div class="form-group">
          <label class="form-label">Votre pseudo Vinted</label>
          <input id="ob-pseudo" class="form-input" type="text" placeholder="Ex : marie_mode_vintage" />
        </div>
        <div class="form-group" style="margin-bottom:0">
          <label class="form-label">Depuis combien de temps vendez-vous sur Vinted ?</label>
          <select class="form-select" id="ob-anciennete">
            <option value="">Choisirâ€¦</option>
            <option>Moins de 6 mois</option>
            <option>6 mois Ã  1 an</option>
            <option>1 Ã  3 ans</option>
            <option>Plus de 3 ans</option>
          </select>
        </div>
      </div>
      <div class="onboarding-nav">
        <div></div>
        <button class="btn btn-primary" onclick="obNext(1)">Continuer â†’</button>
      </div>
    </div>

    <!-- Step 2 â€” ActivitÃ© -->
    <div id="ob-step-2" class="onboarding-step">
      <div class="onboarding-header">
        <div class="onboarding-title">DÃ©crivez votre activitÃ© ğŸ›</div>
        <div class="onboarding-sub">Ces choix affectent la mise en avant des donnÃ©es dans votre interface.</div>
      </div>
      <div class="onboarding-card">
        <div class="form-group">
          <label class="form-label">Quelles catÃ©gories vendez-vous ? (plusieurs choix)</label>
          <div class="tag-grid" id="cat-tags">
            <span class="tag-toggle" onclick="toggleTag(this)">ğŸ‘— VÃªtements femme</span>
            <span class="tag-toggle" onclick="toggleTag(this)">ğŸ‘” VÃªtements homme</span>
            <span class="tag-toggle" onclick="toggleTag(this)">ğŸ‘Ÿ Chaussures</span>
            <span class="tag-toggle" onclick="toggleTag(this)">ğŸ‘œ Sacs & Maroquinerie</span>
            <span class="tag-toggle" onclick="toggleTag(this)">âŒš Montres & Bijoux</span>
            <span class="tag-toggle" onclick="toggleTag(this)">ğŸ§£ Accessoires</span>
            <span class="tag-toggle" onclick="toggleTag(this)">ğŸ‘¶ Enfant</span>
            <span class="tag-toggle" onclick="toggleTag(this)">ğŸ  Maison & DÃ©co</span>
          </div>
        </div>
        <div class="form-group" style="margin-bottom:0">
          <label class="form-label">Volume mensuel moyen de ventes</label>
          <select class="form-select" id="ob-volume">
            <option value="">Choisirâ€¦</option>
            <option>Moins de 10 ventes/mois</option>
            <option>10 Ã  30 ventes/mois</option>
            <option>30 Ã  100 ventes/mois</option>
            <option>Plus de 100 ventes/mois</option>
          </select>
        </div>
      </div>
      <div class="onboarding-nav">
        <button class="btn btn-ghost" onclick="obBack(2)">â† Retour</button>
        <button class="btn btn-primary" onclick="obNext(2)">Continuer â†’</button>
      </div>
    </div>

    <!-- Step 3 â€” Objectifs -->
    <div id="ob-step-3" class="onboarding-step">
      <div class="onboarding-header">
        <div class="onboarding-title">Vos prioritÃ©s ğŸ¯</div>
        <div class="onboarding-sub">Qu'est-ce qui compte le plus pour vous ? Nous affichons en prioritÃ© ce qui vous aide.</div>
      </div>
      <div class="onboarding-card">
        <div class="form-group">
          <label class="form-label" style="margin-bottom:12px;">Ce que vous souhaitez surveiller en prioritÃ©</label>
          <div class="choice-grid">
            <div class="choice-card" onclick="selectChoice(this, 'obj')">
              <div class="choice-icon">ğŸ’°</div>
              <div class="choice-label">Mes revenus</div>
              <div class="choice-sub">CA, marges, Ã©volution</div>
            </div>
            <div class="choice-card" onclick="selectChoice(this, 'obj')">
              <div class="choice-icon">ğŸ“¦</div>
              <div class="choice-label">Mon stock</div>
              <div class="choice-sub">Articles listÃ©s, invendus</div>
            </div>
            <div class="choice-card" onclick="selectChoice(this, 'obj')">
              <div class="choice-icon">ğŸ“ˆ</div>
              <div class="choice-label">Mes performances</div>
              <div class="choice-sub">Taux de vente, tendances</div>
            </div>
            <div class="choice-card" onclick="selectChoice(this, 'obj')">
              <div class="choice-icon">ğŸ›’</div>
              <div class="choice-label">Mes commandes</div>
              <div class="choice-sub">Suivi, expÃ©ditions</div>
            </div>
          </div>
        </div>
        <div class="form-group" style="margin-bottom:0">
          <label class="form-label">Une information complÃ©mentaire (optionnel)</label>
          <textarea class="form-input" id="ob-notes" placeholder="Ex : je vends principalement des montres de luxe, mes prix varient entre 50 et 500â‚¬â€¦"></textarea>
        </div>
      </div>
      <div class="onboarding-nav">
        <button class="btn btn-ghost" onclick="obBack(3)">â† Retour</button>
        <button class="btn btn-primary" id="ob-finish-btn" onclick="finishOnboarding()">
          <span id="ob-finish-label">AccÃ©der Ã  mon tableau de bord â†’</span>
        </button>
      </div>
    </div>

  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN 3 â€” DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-dashboard" class="screen" style="display:none; flex-direction:row;">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-top">
      <div class="sb-logo">Vinted<em>Pro</em></div>
      <div class="sb-user">
        <div class="sb-avatar" id="sb-av">?</div>
        <div>
          <div class="sb-username" id="sb-name">â€”</div>
          <div class="sb-plan">Plan Pro âœ¦</div>
        </div>
      </div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-item active" onclick="setNav(this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
        Vue d'ensemble
      </div>
      <div class="nav-item" onclick="setNav(this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 17H7A5 5 0 0 1 7 7h2"/><path d="M15 7h2a5 5 0 1 1 0 10h-2"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
        Mes donnÃ©es
      </div>
      <div class="nav-section">Analyse</div>
      <div class="nav-item" onclick="setNav(this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
        Statistiques
      </div>
      <div class="nav-item" onclick="setNav(this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        Historique
      </div>
    </nav>
    <div class="sidebar-footer">
      <div class="sidebar-footer-btn" onclick="logout()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        DÃ©connexion
      </div>
    </div>
  </aside>

  <!-- Main -->
  <main class="main-content" id="main">

    <div class="page-header">
      <div>
        <div class="page-title" id="dash-title">Mon tableau de bord</div>
        <div class="page-sub">
          <span class="sync-dot"></span>
          <span id="dash-sub">DonnÃ©es Ã  jour</span>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn btn-ghost" onclick="refreshData()">â†» Actualiser</button>
      </div>
    </div>

    <!-- KPIs -->
    <div class="kpi-grid" id="kpi-grid">
      <!-- Populated by JS -->
    </div>

    <!-- Data table -->
    <div class="data-section">
      <div class="section-header">
        <div class="section-title" id="table-title">Toutes les entrÃ©es</div>
        <div class="section-meta" id="table-meta"></div>
      </div>
      <div class="toolbar">
        <input class="toolbar-search" placeholder="Rechercherâ€¦" oninput="onSearch(this.value)" id="search-input" />
      </div>
      <div class="table-wrap">
        <table class="data-table">
          <thead><tr id="t-head"></tr></thead>
          <tbody id="t-body"></tbody>
        </table>
        <div class="pagination-bar">
          <div class="pagination-info" id="pag-info"></div>
          <div class="pagination-btns" id="pag-btns"></div>
        </div>
      </div>
    </div>

  </main>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FAKE USER DATABASE (demo)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const USERS = {
  'demo@vintedpro.fr': {
    password: 'demo1234',
    name: 'Marie L.',
    pseudo: 'marie_montres',
    notionKey: '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',
    notionDbName: 'BDD Montres',
    firstLogin: true,
  }
};

let currentUser = null;
let state = {
  properties: {}, allRows: [], filteredRows: [],
  page: 0, pageSize: 20, searchQuery: '',
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function togglePwd() {
  const i = document.getElementById('login-password');
  i.type = i.type === 'password' ? 'text' : 'password';
}

async function doLogin() {
  const email = document.getElementById('login-email').value.trim().toLowerCase();
  const pwd   = document.getElementById('login-password').value;
  const btn   = document.getElementById('login-btn');
  const lbl   = document.getElementById('login-label');
  const err   = document.getElementById('login-error');
  err.style.display = 'none';

  if (!email || !pwd) { showLoginError('Merci de remplir tous les champs.'); return; }

  btn.disabled = true;
  lbl.innerHTML = '<div class="spinner"></div> Connexionâ€¦';

  await sleep(900);

  const user = USERS[email];
  if (!user || user.password !== pwd) {
    btn.disabled = false;
    lbl.textContent = 'Se connecter';
    showLoginError('E-mail ou mot de passe incorrect.');
    return;
  }

  currentUser = { ...user, email };

  // First login â†’ onboarding
  if (currentUser.firstLogin) {
    showScreen('screen-onboarding');
  } else {
    await loadDashboard();
  }
}

function showLoginError(msg) {
  const el = document.getElementById('login-error');
  el.textContent = msg; el.style.display = 'block';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ONBOARDING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function obNext(step) {
  document.getElementById(`ob-step-${step}`).classList.remove('active');
  document.getElementById(`ob-step-${step + 1}`).classList.add('active');
  document.getElementById(`track-${step}`).classList.remove('active');
  document.getElementById(`track-${step}`).classList.add('done');
  document.getElementById(`track-${step}`).querySelector('.step-num').textContent = 'âœ“';
  document.getElementById(`track-${step + 1}`).classList.add('active');
}

function obBack(step) {
  document.getElementById(`ob-step-${step}`).classList.remove('active');
  document.getElementById(`ob-step-${step - 1}`).classList.add('active');
  document.getElementById(`track-${step}`).classList.remove('active');
  document.getElementById(`track-${step - 1}`).classList.remove('done');
  document.getElementById(`track-${step - 1}`).classList.add('active');
  document.getElementById(`track-${step - 1}`).querySelector('.step-num').textContent = step - 1;
}

function toggleTag(el) { el.classList.toggle('selected'); }

function selectChoice(el, group) {
  el.closest('.choice-grid').querySelectorAll('.choice-card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
}

async function finishOnboarding() {
  const btn = document.getElementById('ob-finish-btn');
  const lbl = document.getElementById('ob-finish-label');
  btn.disabled = true;
  lbl.innerHTML = '<div class="spinner" style="border-top-color:#000;border-color:rgba(0,0,0,0.15)"></div> Chargementâ€¦';
  currentUser.firstLogin = false;
  currentUser.name = document.getElementById('ob-prenom').value || currentUser.name;
  await loadDashboard();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD LOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadDashboard() {
  showScreen('screen-dashboard');

  // Set user info in sidebar
  const name = currentUser.name || currentUser.email;
  document.getElementById('sb-name').textContent = name;
  document.getElementById('sb-av').textContent = name.charAt(0).toUpperCase();
  document.getElementById('dash-title').textContent = `Bonjour, ${name.split(' ')[0]} ğŸ‘‹`;

  const now = new Date();
  document.getElementById('dash-sub').textContent =
    `DonnÃ©es Ã  jour Â· ${now.toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long'})}`;

  // Show loading skeletons for KPIs
  renderKPISkeleton();

  // Load data
  try {
    await fetchNotionData();
    renderKPIs();
    renderTable();
  } catch(e) {
    console.error(e);
    document.getElementById('kpi-grid').innerHTML =
      `<div style="grid-column:1/-1;color:var(--rose);font-size:0.82rem;padding:20px;">
        Erreur de chargement : ${e.message}
      </div>`;
  }
}

function renderKPISkeleton() {
  document.getElementById('kpi-grid').innerHTML = [0,1,2,3].map(i => `
    <div class="kpi-card k${i}" style="animation-delay:${i*0.07}s">
      <div class="skeleton" style="height:10px;width:70%;margin-bottom:16px;"></div>
      <div class="skeleton" style="height:36px;width:50%;margin-bottom:12px;"></div>
      <div class="skeleton" style="height:10px;width:55%;"></div>
    </div>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA â€” MODE DÃ‰MO (donnÃ©es simulÃ©es)
// Remplacez fetchNotionData() par la version Notion rÃ©elle
// une fois le proxy Cloudflare Worker dÃ©ployÃ©.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchNotionData() {
  await sleep(1200); // simulation du temps de chargement

  document.getElementById('table-title').textContent = 'BDD Montres';

  // Colonnes simulÃ©es (structure identique Ã  Notion)
  state.properties = {
    'Nom'         : { type: 'title' },
    'Marque'      : { type: 'select' },
    'RÃ©fÃ©rence'   : { type: 'rich_text' },
    'Prix achat'  : { type: 'number' },
    'Prix vente'  : { type: 'number' },
    'Statut'      : { type: 'select' },
    'Acheteur'    : { type: 'rich_text' },
    'Date vente'  : { type: 'date' },
    'Lien annonce': { type: 'url' },
    'Notes'       : { type: 'rich_text' },
  };

  const montres = [
    { nom:'Seiko SKX007', marque:'Seiko', ref:'SKX007K2', achat:180, vente:265, statut:{n:'Vendu',c:'green'}, acheteur:'Thomas B.', date:'2026-02-18', lien:'https://vinted.fr', notes:'Bracelet en bon Ã©tat' },
    { nom:'Casio G-Shock DW-5600', marque:'Casio', ref:'DW-5600E-1V', achat:55, vente:90, statut:{n:'Vendu',c:'green'}, acheteur:'Lucas D.', date:'2026-02-20', lien:'https://vinted.fr', notes:'BoÃ®te originale incluse' },
    { nom:'Tissot PR 100', marque:'Tissot', ref:'T101.410.11.031.00', achat:220, vente:310, statut:{n:'En ligne',c:'blue'}, acheteur:'', date:'', lien:'https://vinted.fr', notes:'' },
    { nom:'Orient Bambino V2', marque:'Orient', ref:'FAC00004W0', achat:95, vente:155, statut:{n:'RÃ©servÃ©',c:'orange'}, acheteur:'Sophie M.', date:'', lien:'https://vinted.fr', notes:'Attente paiement' },
    { nom:'Citizen Eco-Drive', marque:'Citizen', ref:'BM7360-82E', achat:130, vente:195, statut:{n:'Vendu',c:'green'}, acheteur:'Emma R.', date:'2026-02-10', lien:'https://vinted.fr', notes:'Bracelet cuir changÃ©' },
    { nom:'Seiko 5 SNKL23', marque:'Seiko', ref:'SNKL23K1', achat:70, vente:115, statut:{n:'En ligne',c:'blue'}, acheteur:'', date:'', lien:'https://vinted.fr', notes:'' },
    { nom:'Hamilton Khaki Field', marque:'Hamilton', ref:'H70455133', achat:380, vente:520, statut:{n:'Vendu',c:'green'}, acheteur:'Paul V.', date:'2026-01-28', lien:'https://vinted.fr', notes:'TrÃ¨s bon Ã©tat gÃ©nÃ©ral' },
    { nom:'Longines HydroConquest', marque:'Longines', ref:'L3.781.4.56.6', achat:650, vente:890, statut:{n:'En ligne',c:'blue'}, acheteur:'', date:'', lien:'https://vinted.fr', notes:'Papiers complets' },
    { nom:'Casio Vintage A168W', marque:'Casio', ref:'A168WA-1YES', achat:18, vente:38, statut:{n:'Vendu',c:'green'}, acheteur:'Clara L.', date:'2026-02-05', lien:'https://vinted.fr', notes:'Iconique, vente rapide' },
    { nom:'Bulova Precisionist', marque:'Bulova', ref:'98B229', achat:175, vente:240, statut:{n:'Invendu',c:'red'}, acheteur:'', date:'', lien:'https://vinted.fr', notes:'Prix Ã  revoir' },
    { nom:'Seiko Presage SRPB41', marque:'Seiko', ref:'SRPB41J1', achat:290, vente:420, statut:{n:'En ligne',c:'blue'}, acheteur:'', date:'', lien:'https://vinted.fr', notes:'Cadran nacre' },
    { nom:'Omega De Ville', marque:'Omega', ref:'424.10.37.20.02.001', achat:1800, vente:2450, statut:{n:'RÃ©servÃ©',c:'orange'}, acheteur:'Marc F.', date:'', lien:'https://vinted.fr', notes:'Vintage 1998, beau cadran' },
    { nom:'Tag Heuer Formula 1', marque:'Tag Heuer', ref:'WAZ1110.BA0875', achat:420, vente:580, statut:{n:'Vendu',c:'green'}, acheteur:'Julie T.', date:'2026-01-15', lien:'https://vinted.fr', notes:'' },
    { nom:'Fossil Grant Chronograph', marque:'Fossil', ref:'FS4776', achat:45, vente:85, statut:{n:'Vendu',c:'green'}, acheteur:'Alex P.', date:'2026-02-01', lien:'https://vinted.fr', notes:'Pile neuve' },
    { nom:'Certina DS Action', marque:'Certina', ref:'C032.407.11.051.00', achat:310, vente:430, statut:{n:'En ligne',c:'blue'}, acheteur:'', date:'', lien:'https://vinted.fr', notes:'200m waterproof' },
    { nom:'Timex Expedition', marque:'Timex', ref:'TW4B14300', achat:25, vente:52, statut:{n:'Vendu',c:'green'}, acheteur:'Nina C.', date:'2026-02-14', lien:'https://vinted.fr', notes:'' },
    { nom:'Rado HyperChrome', marque:'Rado', ref:'R32257152', achat:580, vente:820, statut:{n:'En ligne',c:'blue'}, acheteur:'', date:'', lien:'https://vinted.fr', notes:'CÃ©ramique mate' },
    { nom:'Frederique Constant Slim', marque:'Frederique Constant', ref:'FC-245M5S6', achat:480, vente:650, statut:{n:'Vendu',c:'green'}, acheteur:'David M.', date:'2026-01-22', lien:'https://vinted.fr', notes:'BoÃ®te et papiers' },
    { nom:'Seiko Alpinist SARB017', marque:'Seiko', ref:'SARB017', achat:520, vente:780, statut:{n:'En ligne',c:'blue'}, acheteur:'', date:'', lien:'https://vinted.fr', notes:'TrÃ¨s recherchÃ©' },
    { nom:'Swatch Big Bold', marque:'Swatch', ref:'SB03B100', achat:70, vente:95, statut:{n:'Invendu',c:'red'}, acheteur:'', date:'', lien:'https://vinted.fr', notes:'Couleur peu demandÃ©e' },
  ];

  // Transformer en format pseudo-Notion
  state.allRows = montres.map((m, i) => ({
    id: `row-${i}`,
    properties: {
      'Nom'         : { title: [{ plain_text: m.nom }] },
      'Marque'      : { select: { name: m.marque, color: marqueColor(m.marque) } },
      'RÃ©fÃ©rence'   : { rich_text: [{ plain_text: m.ref }] },
      'Prix achat'  : { number: m.achat },
      'Prix vente'  : { number: m.vente },
      'Statut'      : { select: { name: m.statut.n, color: m.statut.c } },
      'Acheteur'    : { rich_text: m.acheteur ? [{ plain_text: m.acheteur }] : [] },
      'Date vente'  : { date: m.date ? { start: m.date } : null },
      'Lien annonce': { url: m.lien },
      'Notes'       : { rich_text: m.notes ? [{ plain_text: m.notes }] : [] },
    }
  }));

  state.filteredRows = [...state.allRows];
  state.page = 0;
}

function marqueColor(m) {
  const map = { 'Seiko':'blue','Casio':'gray','Tissot':'purple','Orient':'green',
    'Citizen':'blue','Hamilton':'orange','Longines':'pink','Bulova':'brown',
    'Omega':'yellow','Tag Heuer':'red','Fossil':'gray','Certina':'blue',
    'Timex':'green','Rado':'purple','Frederique Constant':'orange','Swatch':'pink' };
  return map[m] || 'default';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ğŸ‘‡ CONFIGUREZ ICI l'URL de votre Cloudflare Worker aprÃ¨s dÃ©ploiement
// Ex: "https://notion-proxy.votre-compte.workers.dev"
// En local (fichier HTML ouvert directement), laissez l'URL Notion directe.
const NOTION_PROXY = "https://api.notion.com";
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function notionFetch(endpoint, method, key, body) {
  const url = `${NOTION_PROXY}/v1${endpoint}`;
  const opts = {
    method,
    headers: {
      'Authorization': `Bearer ${key}`,
      'Notion-Version': '2022-06-28',
      'Content-Type': 'application/json',
    },
  };
  if (body) opts.body = JSON.stringify(body);
  const r = await fetch(url, opts);
  const d = await r.json();
  if (!r.ok) throw new Error(d.message || `Erreur API ${r.status}`);
  return d;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KPIs
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderKPIs() {
  const props = state.properties;
  const rows = state.allRows;
  const kpis = [];

  kpis.push({ label: 'Total entrÃ©es', val: rows.length, sub: 'dans la base', delta: null });

  const numProps = Object.entries(props).filter(([,v]) => v.type === 'number');
  for (const [name] of numProps.slice(0, 2)) {
    const vals = rows.map(r => r.properties[name]?.number).filter(v => v !== null && v !== undefined && !isNaN(v));
    if (vals.length) {
      const sum = vals.reduce((a, b) => a + b, 0);
      kpis.push({ label: `Total â€” ${name}`, val: fmtNum(sum), sub: `${vals.length} valeurs Â· moy. ${fmtNum(sum/vals.length)}`, delta: null });
    }
  }

  const selProps = Object.entries(props).filter(([,v]) => v.type === 'select' || v.type === 'status');
  if (selProps.length) {
    const [name, schema] = selProps[0];
    const vals = rows.map(r => getCellVal(r.properties[name], schema.type)).filter(Boolean);
    const unique = [...new Set(vals)].length;
    kpis.push({ label: `${name}`, val: unique, sub: `valeurs distinctes`, delta: null });
  }

  while (kpis.length < 4) kpis.push({ label: 'Colonnes', val: Object.keys(props).length, sub: 'propriÃ©tÃ©s', delta: null });

  document.getElementById('kpi-grid').innerHTML = kpis.slice(0,4).map((k, i) => `
    <div class="kpi-card k${i}" style="animation-delay:${i*0.07}s">
      <div class="kpi-label">${esc(k.label)}</div>
      <div class="kpi-val">${esc(String(k.val))}</div>
      <div class="kpi-delta neutral">${esc(k.sub)}</div>
    </div>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTable() {
  const props = state.properties;
  const cols = Object.keys(props);
  const rows = state.filteredRows;
  const start = state.page * state.pageSize;
  const page = rows.slice(start, start + state.pageSize);
  const total = Math.ceil(rows.length / state.pageSize);

  document.getElementById('table-meta').textContent = `${rows.length} rÃ©sultat${rows.length > 1 ? 's' : ''}`;

  // Head
  document.getElementById('t-head').innerHTML = cols.map(c => `<th>${esc(c)}</th>`).join('');

  // Body
  if (!rows.length) {
    document.getElementById('t-body').innerHTML = `
      <tr><td colspan="${cols.length}">
        <div class="empty-state">
          <div class="empty-icon">â—</div>
          <div class="empty-title">Aucun rÃ©sultat</div>
          <div class="empty-sub">Modifiez votre recherche</div>
        </div>
      </td></tr>`;
  } else {
    document.getElementById('t-body').innerHTML = page.map(row =>
      `<tr>${cols.map(c => `<td>${renderCell(row.properties[c], props[c]?.type)}</td>`).join('')}</tr>`
    ).join('');
  }

  // Pagination
  document.getElementById('pag-info').textContent =
    `${Math.min(start + 1, rows.length)}â€“${Math.min(start + state.pageSize, rows.length)} sur ${rows.length}`;

  let btns = `<button class="pg-btn" onclick="goPage(${state.page-1})" ${state.page===0?'disabled':''}>â†</button>`;
  pageRange(state.page, total).forEach(p => {
    if (p === 'â€¦') btns += `<span style="color:var(--muted);padding:2px 4px;font-size:0.8rem">â€¦</span>`;
    else btns += `<button class="pg-btn ${p===state.page?'active':''}" onclick="goPage(${p})">${p+1}</button>`;
  });
  btns += `<button class="pg-btn" onclick="goPage(${state.page+1})" ${state.page>=total-1?'disabled':''}>â†’</button>`;
  document.getElementById('pag-btns').innerHTML = btns;
}

function renderCell(prop, type) {
  if (!prop) return '<span class="cell-empty">â€”</span>';
  const v = getCellVal(prop, type);
  if (v === null || v === '' || v === undefined) return '<span class="cell-empty">â€”</span>';
  switch(type) {
    case 'title':
    case 'rich_text': return `<span class="cell-title">${esc(String(v))}</span>`;
    case 'number': return `<span class="cell-num">${fmtNum(v)}</span>`;
    case 'select':
    case 'status': {
      const c = nColor((type==='select'?prop.select:prop.status)?.color);
      return `<span class="tag" style="background:${c}1a;color:${c}">${esc(String(v))}</span>`;
    }
    case 'multi_select':
      return (prop.multi_select||[]).map(o=>{const c=nColor(o.color);return `<span class="tag" style="background:${c}1a;color:${c}">${esc(o.name)}</span>`;}).join('');
    case 'checkbox': return v ? '<span style="color:var(--green)">âœ”</span>' : '<span class="cell-empty">â—‹</span>';
    case 'url': return v ? `<div class="cell-url"><a href="${esc(v)}" target="_blank">â†— Lien</a></div>` : '<span class="cell-empty">â€”</span>';
    case 'date':
    case 'created_time':
    case 'last_edited_time': return `<span class="cell-date">${fmtDate(v)}</span>`;
    case 'email': return v ? `<span style="color:var(--blue);font-size:0.76rem">${esc(v)}</span>` : '<span class="cell-empty">â€”</span>';
    case 'formula': return `<span style="color:var(--muted2)">${esc(String(v))}</span>`;
    default: return `<span>${esc(String(v))}</span>`;
  }
}

function getCellVal(p, type) {
  if (!p) return null;
  switch(type) {
    case 'title': return p.title?.map(t=>t.plain_text).join('') || '';
    case 'rich_text': return p.rich_text?.map(t=>t.plain_text).join('') || '';
    case 'number': return p.number;
    case 'select': return p.select?.name || null;
    case 'status': return p.status?.name || null;
    case 'multi_select': return (p.multi_select||[]).map(o=>o.name).join(', ');
    case 'checkbox': return p.checkbox;
    case 'url': return p.url;
    case 'email': return p.email;
    case 'date': return p.date?.start || null;
    case 'created_time': return p.created_time;
    case 'last_edited_time': return p.last_edited_time;
    case 'formula': { const f=p.formula; return f?.(f.string??f.number??f.boolean??f.date?.start??null):null; }
    case 'people': return (p.people||[]).map(x=>x.name||x.id).join(', ');
    default: return null;
  }
}

function nColor(c) {
  return {default:'#7d8aa0',gray:'#7d8aa0',brown:'#c4906a',orange:'#ffab40',yellow:'#f0c929',
    green:'#4ade80',blue:'#5b9cf6',purple:'#a78bfa',pink:'#e91e8c',red:'#ff6b8a'}[c||'default'] || '#7d8aa0';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SEARCH & PAGINATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onSearch(q) {
  state.searchQuery = q.toLowerCase();
  state.page = 0;
  state.filteredRows = !q ? [...state.allRows] : state.allRows.filter(row =>
    Object.keys(state.properties).some(col => {
      const v = getCellVal(row.properties[col], state.properties[col]?.type);
      return v !== null && String(v).toLowerCase().includes(state.searchQuery);
    })
  );
  renderTable();
}

function goPage(p) {
  const total = Math.ceil(state.filteredRows.length / state.pageSize);
  if (p < 0 || p >= total) return;
  state.page = p;
  renderTable();
  document.getElementById('main').scrollTo({ top: 0, behavior: 'smooth' });
}

function pageRange(cur, total) {
  if (total <= 7) return Array.from({length: total}, (_, i) => i);
  const r = [0];
  if (cur > 2) r.push('â€¦');
  for (let i = Math.max(1, cur-1); i <= Math.min(total-2, cur+1); i++) r.push(i);
  if (cur < total-3) r.push('â€¦');
  r.push(total-1);
  return r;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MISC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function refreshData() {
  renderKPISkeleton();
  state.filteredRows = []; state.allRows = [];
  document.getElementById('search-input').value = '';
  renderTable();
  try {
    await fetchNotionData();
    renderKPIs();
    renderTable();
  } catch(e) { alert('Erreur : ' + e.message); }
}

function setNav(el) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  el.classList.add('active');
}

function logout() {
  currentUser = null;
  state = { properties: {}, allRows: [], filteredRows: [], page: 0, pageSize: 20, searchQuery: '' };
  document.getElementById('login-email').value = '';
  document.getElementById('login-password').value = '';
  document.getElementById('login-btn').disabled = false;
  document.getElementById('login-label').textContent = 'Se connecter';
  document.getElementById('login-error').style.display = 'none';
  showScreen('screen-login');
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => {
    s.classList.remove('active');
    s.style.display = 'none';
  });
  const el = document.getElementById(id);
  el.style.display = id === 'screen-dashboard' ? 'flex' : 'flex';
  el.classList.add('active');
}

function esc(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function fmtNum(n) {
  if (n === null || n === undefined) return 'â€”';
  const num = Number(n);
  return Number.isInteger(num)
    ? num.toLocaleString('fr-FR')
    : num.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}
function fmtDate(d) {
  if (!d) return 'â€”';
  try { return new Date(d).toLocaleDateString('fr-FR', { day:'2-digit', month:'short', year:'numeric' }); }
  catch { return d; }
}
function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

// â”€â”€â”€ Branchement des Ã©vÃ©nements â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('login-btn').addEventListener('click', doLogin);
document.getElementById('login-password').addEventListener('keydown', e => {
  if (e.key === 'Enter') doLogin();
});

}); // fin DOMContentLoaded
</script>
</body>
</html>
